{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Teacher/Documents/GitHub/typesExpress/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/Teacher/Documents/GitHub/typesExpress/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/Teacher/Documents/GitHub/typesExpress/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Teacher/Documents/GitHub/typesExpress/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LongPulling=function LongPulling(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),value=_useState4[0],setValue=_useState4[1];var subscribe=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('http://localhost:5000/get-messages');case 3:_yield$axios$get=_context.sent;data=_yield$axios$get.data;setMessages(function(prev){return[data].concat(_toConsumableArray(prev));});// и снова подписываемя на событие\n_context.next=8;return subscribe();case 8:_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);setTimeout(function(){subscribe();},500);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function subscribe(){return _ref.apply(this,arguments);};}();useEffect(function(){subscribe();},[]);var sendMessage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post('http://localhost:5000/new-messages',{message:value,id:Date.now()});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function sendMessage(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"center\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form\",children:[/*#__PURE__*/_jsx(\"input\",{value:value,onChange:function onChange(e){return setValue(e.target.value);},type:\"text\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"messages\",children:messages.map(function(mess){return/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:mess.message},mess.id);})})]})});};export default LongPulling;","map":{"version":3,"sources":["C:/Users/Teacher/Documents/GitHub/typesExpress/client/src/LongPulling.jsx"],"names":["React","useEffect","useState","axios","LongPulling","messages","setMessages","value","setValue","subscribe","get","data","prev","setTimeout","sendMessage","post","message","id","Date","now","e","target","map","mess"],"mappings":"qrBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,C,wFAEA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,eACUF,QAAQ,CAAC,EAAD,CADlB,wCACfG,QADe,eACLC,WADK,8BAEIJ,QAAQ,CAAC,EAAD,CAFZ,yCAEfK,KAFe,eAERC,QAFQ,eAKtB,GAAMC,CAAAA,SAAS,0FAAG,mMAEaN,CAAAA,KAAK,CAACO,GAAN,CAAU,oCAAV,CAFb,uCAEFC,IAFE,kBAEFA,IAFE,CAGVL,WAAW,CAAC,SAAAM,IAAI,SAAKD,IAAL,4BAAcC,IAAd,IAAL,CAAX,CACA;AAJU,sBAKJH,CAAAA,SAAS,EALL,yFAOVI,UAAU,CAAC,UAAM,CACbJ,SAAS,GACZ,CAFS,CAEP,GAFO,CAAV,CAPU,qEAAH,kBAATA,CAAAA,SAAS,0CAAf,CAaAR,SAAS,CAAC,UAAM,CACZQ,SAAS,GACZ,CAFQ,CAEN,EAFM,CAAT,CAIA,GAAMK,CAAAA,WAAW,2FAAG,+JACVX,CAAAA,KAAK,CAACY,IAAN,CAAW,oCAAX,CAAiD,CACnDC,OAAO,CAAET,KAD0C,CAEnDU,EAAE,CAAEC,IAAI,CAACC,GAAL,EAF+C,CAAjD,CADU,yDAAH,kBAAXL,CAAAA,WAAW,2CAAjB,CAOA,mBACI,YAAK,SAAS,CAAC,QAAf,uBACI,oCACI,aAAK,SAAS,CAAC,MAAf,wBACI,cAAO,KAAK,CAAEP,KAAd,CAAqB,QAAQ,CAAE,kBAAAa,CAAC,QAAIZ,CAAAA,QAAQ,CAACY,CAAC,CAACC,MAAF,CAASd,KAAV,CAAZ,EAAhC,CAA8D,IAAI,CAAC,MAAnE,EADJ,cAEI,eAAQ,OAAO,CAAEO,WAAjB,oEAFJ,GADJ,cAKI,YAAK,SAAS,CAAC,UAAf,UACKT,QAAQ,CAACiB,GAAT,CAAa,SAAAC,IAAI,qBACd,YAAK,SAAS,CAAC,SAAf,UACKA,IAAI,CAACP,OADV,EAA8BO,IAAI,CAACN,EAAnC,CADc,EAAjB,CADL,EALJ,GADJ,EADJ,CAiBH,CA9CD,CAgDA,cAAeb,CAAAA,WAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from \"axios\";\r\n\r\nconst LongPulling = () => {\r\n    const [messages, setMessages] = useState([]);\r\n    const [value, setValue] = useState('');\r\n\r\n\r\n    const subscribe = async () => {\r\n        try {\r\n            const { data } = await axios.get('http://localhost:5000/get-messages')\r\n            setMessages(prev => [data, ...prev])\r\n            // и снова подписываемя на событие\r\n            await subscribe()\r\n        } catch (e) {\r\n            setTimeout(() => {\r\n                subscribe()\r\n            }, 500)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        subscribe()\r\n    }, [])\r\n\r\n    const sendMessage = async () => {\r\n        await axios.post('http://localhost:5000/new-messages', {\r\n            message: value,\r\n            id: Date.now()\r\n        })\r\n    }\r\n\r\n    return (\r\n        <div className=\"center\">\r\n            <div>\r\n                <div className=\"form\">\r\n                    <input value={value} onChange={e => setValue(e.target.value)} type=\"text\" />\r\n                    <button onClick={sendMessage}>Отправить</button>\r\n                </div>\r\n                <div className=\"messages\">\r\n                    {messages.map(mess =>\r\n                        <div className=\"message\" key={mess.id}>\r\n                            {mess.message}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default LongPulling;"]},"metadata":{},"sourceType":"module"}